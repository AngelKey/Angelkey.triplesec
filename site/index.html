<!DOCTYPE html>
<html lang="en">
  <head>
    <title>TripleSec - Symmetric Encryption in the browser</title>
    <meta charset="utf-8">
    <link  href="css/bootstrap.min.css" rel="stylesheet">
    <link  href="css/site.css" rel="stylesheet">
    <link  href='http://fonts.googleapis.com/css?family=Montserrat+Alternates:400,700' rel='stylesheet' type='text/css'>
    <script type="text/javascript"   src="js/triplesec.js"></script>
    <script type="text/javascript"   src="js/jquery.js"></script>
    <script type="text/javascript"   src="js/bootstrap.min.js"></script>
    <script type="text/javascript"   src="js/iced-coffee.js"></script>
    
    <script type="text/coffeescript">

      $ ->
        textarea_auto = (ta) ->
          ta.style.overflow = 'hidden'
          ta.style.height   = 0
          ta.style.height   = "#{25 + Math.min(600,Math.max(ta.scrollHeight, 50))}px"

        input_change = ->
          textarea_auto $('#demo-input-data')[0]
          v = $('#demo-input-data').val()
          k = $('#demo-input-key').val()
          $('.btn-encrypt, .btn-decrypt').prop('disabled', true)
          if v and v.length and k and k.length
            $('.btn-encrypt').prop('disabled', false)
            if (v.match /// ^ [a-f0-9]+ $///i ) and not (v.length % 2)
              $('.btn-decrypt').prop('disabled', false)

        progress_hook = (p) ->
          $("#progress-summary").html "#{p.what} #{p.i}/#{p.total}"

        $('#demo-input-data').on 'change',  -> input_change()
        $('#demo-input-data').on 'keyup',   -> input_change()
        $('#demo-input-key').on  'change',  -> input_change()
        $('#demo-input-key').on  'keyup',   -> input_change()


        $('.btn-encrypt').on 'click', =>
          $('.btn-encrypt, .btn-decrypt').prop('disabled', true)
          data   = new triplesec.Buffer $('#demo-input-data').val()
          key    = new triplesec.Buffer $('#demo-input-key').val()
          await triplesec.encrypt {
            data: data
            key:  key
            rng:  triplesec.rng
            progress_hook: progress_hook
          }, defer err, out
          await setTimeout defer(), 5
          if err
            $("#progress-summary").html err
          else
            hex = out.toString 'hex'          
            $("#demo-input-data").val hex
            textarea_auto $("#demo-input-data")[0]
          input_change()

        $('.btn-decrypt').on 'click', =>
          $('.btn-encrypt, .btn-decrypt').prop('disabled', true)
          data   = new triplesec.Buffer $('#demo-input-data').val(), 'hex'
          key    = new triplesec.Buffer $('#demo-input-key').val()
          await triplesec.decrypt {
            data: data
            key:  key
            progress_hook: progress_hook
          }, defer err, out
          await setTimeout defer(), 5
          if err
            $("#progress-summary").html err
          else
            txt = out.toString()
            $("#demo-input-data").val txt
            textarea_auto $("#demo-input-data")[0]
          input_change()

        textarea_auto $("#demo-input-data")[0]
    </script>
  </head>
  <body>
    <div class="container">

      <div class="row outer-grid">
        <div class="col-xs-3 col-md-2">
          <img src="img/logo.png" class="img-responsive">
        </div><!-- /.outer-grid's 1st column -->
        <div class="col-xs-9 col-md-10">

          <div class="brand">
            TripleSec
          </div>

          <div class="row">
            
            <div class="col-sm-8 intro">
              <p>
                <b>Governments wield great power</b>. Consider:
              </p>
              <ul>
                <li>the USA may compel websites &amp; businesses to "cooperate"</li>
                <li>the NSA may have already broken a popular cipher</li>
              </ul>
              <p>
                If you're a programmer and wish to store user data that <u>only the user can read</u> -- excluding both you and governments -- you must 
                encrypt in the browser or client app with extreme presumption.
              </p>
              <p>Has a government already compromised a popular encryption algorithm?
                Will academia?
                 With a yes in mind,
                <b>TripleSec</b> is a simple, open-source symmetric encryption library for the browser and Node.js. It aims for unbreakable encryption
                 using
                <b class="salsa20">Salsa 20</b>, <b class="aes">AES</b>, and <b class="twofish">Twofish</b>,
                so that a compromise of 1 (or even 2) of the ciphers will expose nothing. The 3 are combined in a
                simple technique outlined by Bruce Schneier in <i>Applied Cryptography</i>.
              </p>
              <p>
                In other words, <b>TripleSec</b> should work unless <i>all 3</i> of have fallen. A dark, dark day that would be.
              </p>
            </div>
            <div class="col-sm-4">

            </div>

          </div>
          <!-- /.row -->


          <div class="demo">

            <h3>Demo</h3>

            <div class="well">

              <form class="form-horizontal" role="form">
                <div class="form-group">
                  <div class="col-sm-7">
                    <textarea class="form-control" rows="5" placeholder="input" id='demo-input-data'></textarea>
                  </div>
                  <div class="col-sm-5">
                    <div class="row">
                      <div class="col-sm-8">
                        <input type="text" class="form-control" placeholder="key (password)" id='demo-input-key'>
                        <div id="progress-summary">
                        </div>
                      </div>
                      <div class="col-sm-4">
                        <div class="btn-group-vertical">
                          <button class="btn btn-encrypt btn-default" type="button" disabled="true">Encrypt</button>
                          <button class="btn btn-decrypt btn-default" type="button" disabled="true">Decrypt</button>
                        </div>
                      </div>
                    </div><!-- /.row -->
                  </div>
                </div>
              </form>

              <div class="encryption-output" style="display:none;">
                <h5>Output</h5>
                <textarea class="output-code form-control" id="demo-output-data"></textarea>
              </div>


            </div>

          </div>
          <!-- /.demo -->

          <div class="installation subsection">
            <h3>Installation</h3>
            <p>
              For the browser, <a href="js/triplesec.js">download triplesec.js</a>, then <code>&lt;script src="triplesec.js"&gt;&lt;/script&gt;</code>. 
            </p>
            <p>
              In node, <code>npm install triplesec</code>.
            </p>
          </div>

          <div class="how-to-use subsection">
            <h3>How to Use It</h3>
            <p>
            Encryption is performed by the <code>encrypt</code> function. It is non-blocking on the CPU
            and calls back with <code>(err, buffer)</code>.
            </p>

            <!--

                SAMPLE CODE PANED SECTION

            -->


            <ul class="nav nav-pills pull-right">
              <li class="pull-right active"><a href="#encrypt-coffeescript" data-toggle="tab">CoffeeScript</a></li>
              <li class="pull-right"><a href="#encrypt-javascript"     data-toggle="tab">JavaScript</a></li>
            </ul>

            <div class="tab-content">
              <div class="tab-pane" id="encrypt-javascript">

                <pre>triplesec.encrypt ({

    data:          new triplesec.Buffer('Pssst. I believe I love you.'),
    key:           new triplesec.Buffer('top-secret-pw'),
    progress_hook: function (step, iterations, i) { /* ... */ }

}, function(err, buff) {
  
    if (! err) { 
        var ciphertext = buff.toString('hex');
    }

});</pre>
              </div><!-- /.tab-pane -->

              <div class="tab-pane active" id="encrypt-coffeescript">

                <pre>triplesec.encrypt

    data:          new triplesec.Buffer 'Pssst. I believe I love you.'
    key:           new triplesec.Buffer 'top-secret-pw'
    progress_hook: (step, iterations, i) -> # ...

, (err, buff) ->

    ciphertext = buff.toString 'hex' unless err</pre>
              </div><!-- /.tab-pane -->
            </div><!-- /.tab-content -->

          <!--

              END PANED SECTION

          -->

              <p>
                TripleSec's <code>decrypt</code> is smoother than a CIA honeypot.
              </p>

            <!--

                SAMPLE CODE PANED SECTION

            -->

            <ul class="nav nav-pills pull-right">
              <li class="pull-right active"><a href="#decrypt-coffeescript" data-toggle="tab">CoffeeScript</a></li>
              <li class="pull-right"><a href="#decrypt-javascript"     data-toggle="tab">JavaScript</a></li>
            </ul>

            <div class="tab-content">
              <div class="tab-pane" id="decrypt-javascript">


          <pre>triplesec.decrypt ({

    data:          new triplesec.Buffer(ciphertext, "hex"),
    key:           new triplesec.Buffer('top-secret-pw'),    
    progress_hook: function (step, iterations, i) { /* ... */ }

}, function (err, buff) {

    if (! err) { 
        console.log(buff.toString());
    }  

});

var plaintext = b.toString();</pre>
              </div><!-- /.tab-pane -->
              <div class="tab-pane active" id="decrypt-coffeescript">


          <pre>triplesec.decrypt

    data:          new triplesec.Buffer ciphertext, 'hex'
    key:           new triplesec.Buffer 'top-secret-pw'
    progress_hook: (step, iterations, i) -> # ...

, (err, buff) ->

    console.log b.toString() unless err</pre>
              </div><!-- /.tab-pane -->              
            </div><!-- /.tab-content -->

          </div><!-- /.how-to-use -->

          <div class="questions subsection">
            <h3>Anticipated Questions</h3>
            <div class="question">
              <h5>Wait, so how are the 3 ciphers combined?</h5>
              <p class="answer">
                Like magic.
              </p>
              <h5>What's triplesec.Buffer?</h5>
              <p class="answer">
                It is
                just a convenience wrapper around either Node.js's Buffer or a browser equivalent. When you generate
                encrypted data, you can leave it as a buffer,
                if that's useful. Or you can convert to 'base64' and other formats, too. This page demos hex conversion.
              </p>
              <h5>How does triplec generate randomness? And can I change it?</h5>
              <h5>How are passphrases salted?</h5>
              <h5>Can I encrypt files with it, in the browser?</h5>
            </div>
          </div>

          <div class="whos-using subsection">
            <h3>Who's Using it?</h3>
            <p>
              We are! (<a href="http://www.twitter.com/maxtaco">Max Krohn</a> &amp; <a href="http://www.twitter.com/malgorithms">Chris Coyne</a>). We're working on an unrelated site
              now, and TripleSec will be used to encrypt our users' keys.
            </p>
            <p>
              If you use TripleSec, please contact us, and we'll mention you here. 
            </p>
            <p>
              Here are some ideas, in case you're feeling ambitious:
            </p>
            <ul>
              <li>a TripleSec browser extension for highlighting and encrypting/decrypting text on any page</li>
              <li>diary/journal</li>
              <li>key storage</li>
              <li>password manager</li>
              <li>Bitcoin wallet</li>
            </ul>
          </div>

          <div class="whos-using subsection">
            <h3>Can I help?</h3>
            <p>
              Please! Above all else, we encourage <a href="http://github.com/keybase/triplesec">review of the source code</a>.
            </p>
          </div>

        </div><!-- /.outer-grid's 2nd column -->
      </div><!-- /.outer-grid -->

    </div><!-- /.container -->

  </body>
</html>